<div class="chat-list-container">
  <!-- Header -->
  <div class="chat-list-header">
    <h2 class="title">Messages</h2>
    <button class="new-chat-btn" (click)="showSearch = !showSearch" title="New Chat">
      <i class="fa fa-plus"></i>
    </button>
  </div>

  <!-- Connection Status -->
  <div *ngIf="!isConnected" class="connection-status">
    <i class="fa fa-exclamation-circle"></i>
    Connecting to chat...
  </div>

  <!-- Search Box -->
  <div *ngIf="showSearch" class="search-container">
    <input 
      type="text" 
      class="search-input"
      placeholder="Search users to chat..."
      [(ngModel)]="searchQuery"
      (input)="onSearchInput()">
    
    <div *ngIf="searchResults.length > 0" class="search-results">
      <div *ngFor="let user of searchResults" 
           class="search-result-item"
           (click)="startNewChat(user)">
        <img [src]="user.profileImageUrl || 'assets/default-avatar.png'" 
             class="avatar-small">
        <div class="user-info">
          <div class="username">{{ user.username }}</div>
          <div class="fullname">{{ user.fullName }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>Loading conversations...</p>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && conversations.length === 0" class="empty-state">
    <i class="fa fa-comments fa-3x"></i>
    <p>No conversations yet</p>
    <button class="btn-primary" (click)="showSearch = true">Start a conversation</button>
  </div>

  <!-- Conversations List -->
  <div *ngIf="!isLoading && conversations.length > 0" class="conversations-list">
    <div *ngFor="let conversation of conversations"
         class="conversation-item"
         (click)="selectConversation(conversation)">
      
      <div class="conversation-avatar">
        <img [src]="conversation.otherUser.profileImageUrl || 'assets/default-avatar.png'" 
             [alt]="conversation.otherUser.fullName">
        <span class="online-indicator" [class.online]="conversation.otherUser.isOnline"></span>
      </div>

      <div class="conversation-info">
        <div class="conversation-header">
          <h4>{{ conversation.otherUser.fullName }}</h4>
          <span class="conversation-time">
            {{ formatMessageTime(conversation.lastMessageAt) }}
          </span>
        </div>
        <div class="conversation-preview">
          <p>{{ conversation.lastMessage?.content || 'No messages yet' }}</p>
          <span *ngIf="conversation.unreadCount > 0" class="unread-badge">
            {{ conversation.unreadCount }}
          </span>
        </div>
      </div>

      <button class="delete-btn" (click)="deleteConversation($event, conversation)" title="Delete">
        <i class="fa fa-trash"></i>
      </button>
    </div>
  </div>
</div>